$(document).ready(function(){var a;var d;var c=$("<audio></audio>");var b=$("<audio></audio>");if(check_audio()){c.attr("id","audio_1").append('<source src="../sounds/alert_1.ogg" type="audio/ogg">').append('<source src="../sounds/alert_1.mp3" type="audio/mpeg">').append('<source src="../sounds/alert_1.wav" type="audio/wav">').appendTo("body");b.attr("id","audio_2").append('<source src="../sounds/alert_2.ogg" type="audio/ogg">').append('<source src="../sounds/alert_2.mp3" type="audio/mpeg">').append('<source src="../sounds/alert_2.wav" type="audio/wav">').appendTo("body")}$("#form_1").on("keyup","#message",function(){clearTimeout(a);var e;if($(this).val()==""){e=0}else{e=1}a=setTimeout(function(){data="action=operator_typing&operator_typing="+e;$.ajax({type:"POST",url:"process.php",dataType:"json",data:data})},200)});$("#form_1").on("keydown","#message",function(e){if(e.keyCode==13){e.preventDefault();send_message($(this).parents("form"))}});$("#form_1").on("click","#send_message",function(e){e.preventDefault();send_message($(this).parents("form"))});$("body").on("click",".start_chat",function(e){e.preventDefault();data="action=operator_start_chat&chat_id="+$(this).data("id");$.ajax({type:"POST",url:"process.php",dataType:"json",data:data,success:function(f){if(f.success){get_chat();d=setInterval(get_chat,console_interval);$("#form_1").show()}}})});$("#form_1").on("click","#stop_chat",function(e){e.preventDefault();clearInterval(d);data="action=operator_stop_chat";$.ajax({type:"POST",url:"process.php",dataType:"json",data:data,success:function(f){if(f.success){$(".message_content").empty();$("#form_1").hide()}}})});$("body").on("click",".open_chat",function(e){e.preventDefault();data="action=operator_open_chat&chat_id="+$(this).data("id");$.ajax({type:"POST",url:"process.php",dataType:"json",data:data,success:function(f){if(f.success){get_chat();d=setInterval(get_chat,console_interval);$("#form_1").show(function(){$(".message_content").scrollTop($(".message_content")[0].scrollHeight)})}}})});$("body").on("click",".watch_chat",function(e){e.preventDefault();data="action=operator_watch_chat&chat_id="+$(this).data("id");$.ajax({type:"POST",url:"process.php",dataType:"json",data:data,success:function(f){if(f.success){get_chat();d=setInterval(get_chat,console_interval);$("#form_1").hide(function(){$(".message_content").scrollTop($(".message_content")[0].scrollHeight)})}}})});$("body").on("click",".transfer_chat",function(e){e.preventDefault();data="action=operator_transfer_chat&department_id="+$(this).data("id");$.ajax({type:"POST",url:"process.php",dataType:"json",data:data,success:function(f){if(f.success){clearInterval(d);$(".message_content").empty();$("#form_1").hide()}}})});$("#canned_messages").on("change",function(){$("#message").val(this.value)});$("a.sound").click(function(e){e.preventDefault();if($("a.sound i").hasClass("icon-volume-up")){$("a.sound i").removeClass("icon-volume-up").addClass("icon-volume-off");$("#audio_1").prop("muted",true);$("#audio_2").prop("muted",true)}else{$("a.sound i").removeClass("icon-volume-off").addClass("icon-volume-up");$("#audio_1").prop("muted",false);$("#audio_2").prop("muted",false)}});$("a.status").click(function(e){e.preventDefault();data="action=operator_update_status";$.ajax({type:"POST",url:"process.php",dataType:"json",data:data,success:function(f){if(f.success){get_operator_status()}}})});$("body").on("click","#invite_visitor",function(e){e.preventDefault();$("#form_2").show();$("#ip_address").val($(this).data("ip"))});$("#form_2").validate({rules:{invitation_message:"required"},messages:{invitation_message:"Please write a message"},errorPlacement:function(e,f){f.attr("placeholder",e.text())}});$("body").on("click","#send_invitation",function(e){e.preventDefault();var f=$("#form_2").valid();if(f){data=$("#form_2").serialize()+"&action=operator_send_invitation";$.ajax({type:"POST",url:"process.php",dataType:"json",data:data,success:function(g){if(g.success){$("#form_2").hide(function(){$("#alert_1").show();$("#invitation_message").val("")})}else{alert(g.content)}}})}});$("body").on("click","#alert_1 a.close",function(e){e.preventDefault();$("#alert_1").hide()});$("#form_1").on("click","#update_online_departments",function(e){e.preventDefault();$(".dropdown-toggle").dropdown();data="action=operator_get_online_departments";$.ajax({type:"POST",url:"process.php",dataType:"json",data:data,success:function(f){if(f.success){$("#online_departments").html(f.content)}else{$("#online_departments").html(f.content)}}})})});function send_message(a){$("#form_1").validate({onkeyup:false,rules:{message:"required"},messages:{message:"Please write a message"}});var b=$("#form_1").valid();if(b){data=a.serialize()+"&action=operator_send_message";$.ajax({type:"POST",url:"process.php",dataType:"json",data:data,success:function(c){if(c.success){get_chat();$("#form_1")[0].reset()}else{alert(c.content)}}})}}function get_chat(){data="action=operator_get_chat";$.ajax({type:"POST",url:"process.php",dataType:"json",data:data,success:function(a){if(a.success){$(".message_content").html(a.content);if(a.new_message){$("#audio_1").trigger("play");$(".message_content").scrollTop($(".message_content")[0].scrollHeight)}if(a.user_typing){$(".user_typing span").show()}else{$(".user_typing span").hide()}}else{location.reload()}}})}function get_online_visitors(){data="action=operator_get_online_visitors";$.ajax({type:"POST",url:"process.php",dataType:"json",data:data,success:function(a){if(a.success){$("#online_visitors").html(a.content)}else{$("#online_visitors").html(a.content)}}})}function get_pending_chat(){data="action=operator_get_pending_chat";$.ajax({type:"POST",url:"process.php",dataType:"json",data:data,success:function(a){if(a.success){$("#pending_chat").html(a.content);if(a.new_chat){$("#audio_2").trigger("play")}}else{$("#pending_chat").html(a.content)}}})}function get_operator_status(){data="action=operator_get_status";$.ajax({type:"POST",url:"process.php",dataType:"json",data:data,success:function(a){if(a.success){$("a.status span").html(a.content)}else{$("a.status span").html(a.content)}}})}function check_audio(){var a=$("<audio></audio>");if(a.get(0).canPlayType){return true}else{return false}};